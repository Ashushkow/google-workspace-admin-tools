# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞: **"–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"**

## üîç –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å email –∏–∑ –¥–æ–º–µ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç Google Workspace (–Ω–∞–ø—Ä–∏–º–µ—Ä, `user@external-domain.com`). –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. Google API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É **403 "Not Authorized to access this resource/api"**
2. –§—É–Ω–∫—Ü–∏—è `user_exists()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` (—á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "–æ—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏")
3. –§—É–Ω–∫—Ü–∏—è `create_user()` –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º—É —Å API –∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `user_exists()`

**–§–∞–π–ª:** `src/api/users_api.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 403 –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- –ï—Å–ª–∏ email –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–µ–º—É –¥–æ–º–µ–Ω—É, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω)
- –ï—Å–ª–∏ email –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –Ω–∞—à–µ–º—É –¥–æ–º–µ–Ω—É, –Ω–æ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` (–æ—à–∏–±–∫–∞ API)

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `create_user()`

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ email –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥–æ–º–µ–Ω—É Google Workspace
- –ï—Å–ª–∏ –¥–æ–º–µ–Ω –≤–Ω–µ—à–Ω–∏–π, –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –¥–æ–º–µ–Ω–∞—Ö

### 3. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –†–∞–∑–ª–∏—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ (–≤–Ω–µ—à–Ω–∏–π –¥–æ–º–µ–Ω vs. –ø—Ä–æ–±–ª–µ–º–∞ API)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `test_user_exists.py` - —Ç–µ—Å—Ç –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `test_problem_scenarios.py` - —Ç–µ—Å—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- `test_domain_validation.py` - —Ç–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–æ–≤

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚úÖ –û—à–∏–±–∫–∞: –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –≤ –¥–æ–º–µ–Ω–µ sputnik8.com. 
   –£–∫–∞–∑–∞–Ω–Ω—ã–π email –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –¥–æ–º–µ–Ω—É external-domain.com.
```

## üìã –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
result = create_user(
    service=service,
    email="new.user@sputnik8.com",  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
    first_name="John",
    last_name="Doe", 
    password="SecurePass123!"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: new.user@sputnik8.com –≤ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ /"
```

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤–Ω–µ—à–Ω–µ–º –¥–æ–º–µ–Ω–µ
```python
result = create_user(
    service=service,
    email="user@gmail.com",  # ‚ùå –í–Ω–µ—à–Ω–∏–π –¥–æ–º–µ–Ω
    first_name="John",
    last_name="Doe",
    password="SecurePass123!"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–û—à–∏–±–∫–∞: –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –≤ –¥–æ–º–µ–Ω–µ sputnik8.com..."
```

### ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```python
result = create_user(
    service=service,
    email="existing.user@sputnik8.com",  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å
    first_name="John", 
    last_name="Doe",
    password="SecurePass123!"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email existing.user@sputnik8.com —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –æ—à–∏–±–æ–∫
- **404** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- **403** - –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É:
  - –î–ª—è –≤–Ω–µ—à–Ω–∏—Ö –¥–æ–º–µ–Ω–æ–≤ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `False`
  - –î–ª—è –Ω–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None` (–æ—à–∏–±–∫–∞)

### –í–∞–ª–∏–¥–∞—Ü–∏—è email
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∏–º–≤–æ–ª–∞ `@`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –∏–∑ email
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥–æ–º–µ–Ω–æ–º Google Workspace –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–Ω–∏–º–∞—é—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫
2. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API
3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–º–µ–Ω –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`config.settings.google_workspace_domain`)
- –ò–º–µ–µ—Ç fallback –Ω–∞ `"sputnik8.com"` –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
