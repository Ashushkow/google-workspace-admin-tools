#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
"""

import sys
import os
from pathlib import Path
import tkinter as tk

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ Python path
sys.path.insert(0, str(Path(__file__).parent.parent / 'src'))

def test_optimized_dialog():
    """–¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞"""
    try:
        from src.ui.sputnik_calendar_ui import AddSputnikMemberDialog
        from src.api.sputnik_calendar import create_sputnik_calendar_manager
        
        print("üöÄ –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ —Å –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π...")
        
        # –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
        calendar_manager = create_sputnik_calendar_manager()
        if not calendar_manager:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä")
            return
        
        print("‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–Ω")
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–Ω–µ–≤–æ–µ –æ–∫–Ω–æ
        root = tk.Tk()
        root.title("–¢–µ—Å—Ç –ë–´–°–¢–†–û–ì–û –¥–∏–∞–ª–æ–≥–∞ SPUTNIK")
        root.geometry("500x300")
        
        # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞
        def open_dialog():
            def refresh_dummy():
                print("‚úÖ –î–∏–∞–ª–æ–≥ –±—ã–ª –∑–∞–∫—Ä—ã—Ç (refresh callback)")
            
            dialog = AddSputnikMemberDialog(root, calendar_manager, refresh_dummy)
            print("‚úÖ –î–∏–∞–ª–æ–≥ –æ—Ç–∫—Ä—ã—Ç —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π!")
            print("üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:")
            print("  ‚ö° –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)")
            print("  ‚ùå –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏") 
            print("  üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
            print("  üì• –ö–Ω–æ–ø–∫–∞ '–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ' –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞")
        
        # –°–æ–∑–¥–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
        info_text = tk.Text(
            root, 
            height=12,
            width=60,
            font=("Arial", 10),
            wrap="word",
            padx=10,
            pady=10
        )
        info_text.pack(expand=True, fill="both", padx=20, pady=10)
        
        info_content = """üéØ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –î–ò–ê–õ–û–ì–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –£–ß–ê–°–¢–ù–ò–ö–û–í:

‚ö° –ë–´–°–¢–†–ê–Ø –ó–ê–ì–†–£–ó–ö–ê:
‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤–º–µ—Å—Ç–æ 500)
‚Ä¢ –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —É–º–µ–Ω—å—à–µ–Ω–æ –≤ ~10 —Ä–∞–∑
‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç

‚ùå –û–¢–ú–ï–ù–ê –ó–ê–ì–†–£–ó–ö–ò:
‚Ä¢ –ö–Ω–æ–ø–∫–∞ "‚ùå –û—Ç–º–µ–Ω–∞" –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–º–µ–Ω—ã –∫–∞–∂–¥—ã–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ Fallback –Ω–∞ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

üíæ –ö–≠–®–ò–†–û–í–ê–ù–ò–ï:
‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
‚Ä¢ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

üì• –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê:
‚Ä¢ –ö–Ω–æ–ø–∫–∞ "üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–µ" –ø–æ—Å–ª–µ –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ (500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) –ø–æ –∂–µ–ª–∞–Ω–∏—é

üîç –£–ú–ù–´–ô –ü–û–ò–°–ö:
‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∏–º–µ–Ω–∏ –∏ email –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫"""
        
        info_text.insert("1.0", info_content)
        info_text.config(state="disabled")
        
        # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞
        btn = tk.Button(
            root, 
            text="üéØ –û–¢–ö–†–´–¢–¨ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –î–ò–ê–õ–û–ì",
            command=open_dialog,
            font=("Arial", 12, "bold"),
            bg="#2E8B57",
            fg="white",
            pady=8
        )
        btn.pack(pady=10)
        
        print("‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫–Ω–æ –≥–æ—Ç–æ–≤–æ")
        print("üí° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ë–´–°–¢–†–û–ì–û –¥–∏–∞–ª–æ–≥–∞")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
        root.mainloop()
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    test_optimized_dialog()
